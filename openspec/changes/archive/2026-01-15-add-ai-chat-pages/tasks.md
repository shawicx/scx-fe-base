# Tasks: add-ai-chat-pages

## Phase 1: AI 配置页面

### 1.1 创建 AI 配置页面组件

- [x] 创建 `src/routes/ai-config.tsx`
- [x] 实现页面基本布局（使用 UnoCSS）
- [x] 添加页面标题和描述
- [x] 添加路由到 `src/App.tsx`

**验收标准：**

- 访问 `/ai/config` 能显示页面
- 页面标题为"AI 配置"
- 使用 UnoCSS 样式

### 1.2 实现获取提供商列表功能

- [x] 调用 `getAiProvidersApi` 获取可用提供商
- [x] 显示提供商列表
- [x] 处理加载状态
- [x] 处理错误情况（使用 Toast）

**验收标准：**

- 页面加载时自动获取提供商列表
- 显示加载指示器
- 错误时显示 Toast 提示

### 1.3 实现 API Key 配置表单

- [x] 为每个提供商创建 API Key 输入框
- [x] 实现显示/隐藏 API Key 功能
- [x] 添加表单验证（API Key 不能为空）
- [x] 使用 Zod schema 验证

**验收标准：**

- 每个提供商都有独立的 API Key 输入框
- 可以切换显示/隐藏 API Key
- 空值时显示验证错误

### 1.4 实现默认提供商选择

- [x] 添加默认提供商单选框或下拉框
- [x] 保存默认提供商选择

**验收标准：**

- 可以选择默认提供商
- 默认提供商选择器正常工作

### 1.5 实现测试连接功能

- [x] 添加"测试连接"按钮
- [x] 调用 `postAiTestConnectionApi` 测试 API Key
- [x] 显示测试结果（成功/失败）
- [x] 使用 Toast 显示测试结果

**验收标准：**

- 点击按钮后测试对应提供商的连接
- 成功时显示绿色成功提示
- 失败时显示红色错误提示
- 测试时按钮显示加载状态

### 1.6 实现保存配置功能

- [x] 添加"保存配置"按钮
- [x] 调用 `putAiConfigApi` 保存配置
- [x] 使用 Toast 显示保存结果
- [x] 保存成功后跳转到对话页面（可选）

**验收标准：**

- 点击按钮后保存配置
- 成功时显示成功提示
- 失败时显示错误提示
- 保存时按钮显示加载状态

## Phase 2: AI 对话页面

### 2.1 创建 AI 对话页面组件

- [x] 创建 `src/routes/ai-chat.tsx`
- [x] 实现页面基本布局（使用 UnoCSS）
- [x] 添加页面标题
- [x] 添加路由到 `src/App.tsx`

**验收标准：**

- 访问 `/ai/chat` 能显示页面
- 页面标题为"AI 对话"
- 使用 UnoCSS 样式

### 2.2 实现消息列表显示

- [x] 创建消息列表容器（滚动区域）
- [x] 创建用户消息气泡组件
- [x] 创建 AI 消息气泡组件
- [x] 区分用户和 AI 消息样式

**验收标准：**

- 消息列表可滚动
- 用户消息靠右显示
- AI 消息靠左显示
- 使用不同颜色区分

### 2.3 实现消息输入功能

- [x] 添加多行文本输入框
- [x] 添加"发送"按钮
- [x] 支持回车键发送（Shift+Enter 换行）
- [x] 添加输入框高度自适应

**验收标准：**

- 可以输入多行文本
- 按 Enter 发送消息
- Shift+Enter 换行
- 输入框高度随内容调整

### 2.4 实现发送消息功能

- [x] 调用 `postAiCompletionApi` 发送消息
- [x] 维护消息历史状态
- [x] 显示用户消息
- [x] 显示 AI 响应
- [x] 处理加载状态

**验收标准：**

- 发送消息后显示在列表中
- AI 响应后显示在列表中
- 等待响应时显示加载指示器
- 支持多轮对话（传递历史消息）

### 2.5 实现错误处理

- [x] 捕获 API 错误
- [x] 使用 Toast 显示错误消息
- [x] 提供"配置 API Key"链接（当未配置时）

**验收标准：**

- API 错误时显示 Toast 提示
- 点击链接跳转到配置页面

### 2.6 实现对话历史管理（可选）

- [x] 添加"清空对话"按钮
- [x] 确认清空操作
- [x] 重置消息历史

**验收标准：**

- 可以清空对话历史
- 清空前有确认提示

## Phase 3: 导航和链接

### 3.1 添加页面间导航

- [x] 在配置页面添加"前往对话"链接
- [x] 在对话页面添加"配置 AI"链接

**验收标准：**

- 可以在两个页面之间导航

### 3.2 更新首页导航

- [x] 在首页添加 AI 功能入口链接

**验收标准：**

- 首页有链接跳转到 AI 配置或对话页面

## Phase 4: 验证和测试

### 4.1 运行 Lint 检查

- [x] 运行 `npm run lint`
- [x] 修复所有 lint 错误

**验收标准：**

- 通过 lint 检查

### 4.2 运行类型检查

- [x] 运行 `npm run typecheck`
- [x] 修复所有类型错误

**验收标准：**

- 通过类型检查

### 4.3 手动测试

- [x] 测试配置页面所有功能
- [x] 测试对话页面所有功能
- [x] 测试页面导航
- [x] 测试错误场景

**验收标准：**

- 所有功能正常工作
- 错误场景有适当提示

### 4.4 代码审查

- [x] 检查代码风格一致性
- [x] 检查注释完整性
- [x] 检查命名规范

**验收标准：**

- 代码符合项目规范
- 有必要的注释

## 依赖关系

- **Phase 1** 必须在 **Phase 2** 之前完成
- **Phase 3** 可以在 **Phase 2** 完成后进行
- **Phase 4** 必须在所有开发任务完成后进行

## 并行任务

以下任务可以并行开发：

- 1.1 和 2.1（创建页面组件）
- 1.2 和 1.3（获取提供商和配置表单）
- 1.5 和 1.6（测试连接和保存配置）
- 2.2 和 2.3（消息列表和输入功能）

## 预估时间

- Phase 1: 4-6 小时
- Phase 2: 4-6 小时
- Phase 3: 1-2 小时
- Phase 4: 1-2 小时

**总计：** 10-16 小时
